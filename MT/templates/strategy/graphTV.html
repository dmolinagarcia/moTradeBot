<!-- Chart Div PlaceHolder -->
 TV Graphs. Experimental!
     <!-- Selector de intervalos -->
     <div id="interval-selector">
      <button onclick="setIntervalData('15m')">15 Minutos</button>
      <button onclick="setIntervalData('1h')">1 Hora</button>
      <button onclick="setIntervalData('4h')">4 Horas</button>
      <button onclick="setIntervalData('1d')">1 Día</button>
      <button onclick="setIntervalData('1w')">1 Semana</button>
  </div>

  <!-- Contenedor del gráfico -->
  <div id="crypto-chart"></div>

  <script>
    // Crear el gráfico
    const chart = LightweightCharts.createChart(document.getElementById('crypto-chart'), {
        layout: {
            backgroundColor: '#ffffff',
            textColor: '#000000',
        },
        width: document.getElementById('crypto-chart').clientWidth,
        height: document.getElementById('crypto-chart').clientHeight,
        grid: {
            vertLines: {
                color: '#f0f3fa',
            },
            horzLines: {
                color: '#f0f3fa',
            },
        },
        timeScale: {
            timeVisible: true,
            secondsVisible: false,
        },
    });

    // Añadir una serie de velas (Candlestick)
    const candlestickSeries = chart.addCandlestickSeries({
        upColor: '#4caf50',
        downColor: '#f44336',
        borderUpColor: '#4caf50',
        borderDownColor: '#f44336',
        wickUpColor: '#4caf50',
        wickDownColor: '#f44336',
    });

    // Extraer strategy_id y operation_id de la URL actual
    let currentInterval = '4h';  // El intervalo inicial
    const urlParts = window.location.pathname.split('/');
    const strategyId = urlParts[2];
    const operationId = urlParts[3];

    // Función para obtener datos desde el servidor
    async function fetchData(interval) {
        const endpoint = `/getHistory/${strategyId}/${operationId}/${interval}`;
        try {
            const response = await fetch(endpoint);
            if (!response.ok) {
                throw new Error(`Error al obtener datos: ${response.status}`);
            }
            const data = await response.json();
            return data;
        } catch (error) {
            console.error(error);
            return [];
        }
    }

    // Función para establecer los datos en el gráfico
    async function setIntervalData(interval) {
        const data = await fetchData(interval);
        candlestickSeries.setData(data);
        // Ajusta el intervalo del gráfico
        adjustTimeScale(interval);        
    }

    // Inicialización con el intervalo de 4 horas
    setIntervalData('4h');

    // Función para ajustar el intervalo temporal del gráfico
    function adjustTimeScale(interval) {
       let secondsPerCandle = 0;
    
       switch (interval) {
           case '15m':
               secondsPerCandle = 15 * 60;  // 15 minutos
               break;
           case '4h':
               secondsPerCandle = 4 * 60 * 60;  // 4 horas
               break;
           case '1d':
               secondsPerCandle = 24 * 60 * 60;  // 1 día
               break;
           case '1w':
               secondsPerCandle = 7 * 24 * 60 * 60;  // 1 semana
               break;
           default:
               secondsPerCandle = 24 * 60 * 60;  // Por defecto 1 día
               break;
       }

        // Ajustar la escala de tiempo para que las velas se muestren correctamente
        chart.timeScale().setBarSpacing(secondsPerCandle);
    }   

    // Ajustar tamaño del gráfico al redimensionar la ventana
    window.addEventListener('resize', () => {
        chart.applyOptions({
            width: document.getElementById('crypto-chart').clientWidth,
        });
    });
</script>