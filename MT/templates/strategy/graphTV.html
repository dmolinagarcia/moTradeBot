<!-- Chart Div PlaceHolder -->
 TV Graphs. Experimental!
     <!-- Selector de intervalos -->
     <div id="interval-selector">
      <button onclick="setIntervalData('15m')">15 Minutos</button>
      <button onclick="setIntervalData('1h')">1 Hora</button>
      <button onclick="setIntervalData('4h')">4 Horas</button>
      <button onclick="setIntervalData('1d')">1 Día</button>
      <button onclick="setIntervalData('1w')">1 Semana</button>
  </div>

  <!-- Contenedor del gráfico -->
  <div id="crypto-chart"></div>

  <script>
    // Asignar un ancho fijo para las etiquetas de la escala de precios
    const fixedScaleWidth = 120; // Puedes ajustar este valor según sea necesario

    // Crear el gráfico principal
    const chart = LightweightCharts.createChart(document.getElementById('crypto-chart'), {
        layout: { backgroundColor: '#ffffff', textColor: '#000000', },
        width: document.getElementById('crypto-chart').clientWidth,
        height: 300 , // Altura del gráfico primario
        grid: { vertLines: { color: '#f0f3fa', },
                horzLines: { color: '#f0f3fa', },
        },
        timeScale: { timeVisible: true, secondsVisible: false, },
        rightPriceScale: { visible: true, minimumWidth: fixedScaleWidth, }, // Ancho fijo para el gráfico principal
        watermark: { visible: true, fontSize: 16, color: 'rgba(0, 0, 0, 0.1)', text: 'TradingView', },
    });

    // Añadir una serie de velas (Candlestick)
    const candlestickSeries = chart.addCandlestickSeries({
        upColor: '#4caf50',
        downColor: '#f44336',
        borderUpColor: '#4caf50',
        borderDownColor: '#f44336',
        wickUpColor: '#4caf50',
        wickDownColor: '#f44336',
    });

    // Gráfico secundario (ADX)
    const adxChart = LightweightCharts.createChart(document.getElementById('crypto-chart'), {
        layout: { backgroundColor: '#ffffff', textColor: '#000000' },
        width: document.getElementById('crypto-chart').clientWidth,
        height: 150, // Altura del gráfico secundario
        timeScale: { timeVisible: true, secondsVisible: false, visible: true }, // Sin escala de tiempo visible
        rightPriceScale: { visible: true, minimumWidth: fixedScaleWidth, }, // Ancho fijo para el gráfico principal
    });

    // Línea ADX
    const adxSeries = adxChart.addLineSeries({
        color: '#ff9800', // Naranja para ADX
        lineWidth: 2,
    });

    // Línea +DI
    const plusDiSeries = adxChart.addLineSeries({
        color: '#4caf50', // Verde para +DI
        lineWidth: 2,
    });

    // Línea -DI
    const minusDiSeries = adxChart.addLineSeries({
        color: '#f44336', // Rojo para -DI
        lineWidth: 2,
    });


    // Establecer los datos en cada serie
    adxSeries.setData([
        { time: 1640995200, value: 20 },
        { time: 1640996700, value: 25 },
        { time: 1640998200, value: 30 },
        { time: 1640999700, value: 35 },
        { time: 1641001200, value: 28 },
    ]);

    plusDiSeries.setData([
        { time: 1640995200, value: 15 },
        { time: 1640996700, value: 20 },
        { time: 1640998200, value: 25 },
        { time: 1640999700, value: 30 },
        { time: 1641001200, value: 27 },
    ]);

    minusDiSeries.setData([
        { time: 1640995200, value: 10 },
        { time: 1640996700, value: 12 },
        { time: 1640998200, value: 18 },
        { time: 1640999700, value: 22 },
        { time: 1641001200, value: 25 },
    ]);

    // Extraer strategy_id y operation_id de la URL actual
    let currentInterval = '4h';  // El intervalo inicial
    const urlParts = window.location.pathname.split('/');
    const strategyId = urlParts[2];
    const operationId = urlParts[3];

    // Función para obtener datos desde el servidor
    async function fetchData(interval) {
        const endpoint = `/getHistory/${strategyId}/${operationId}/${interval}`;
        try {
            const response = await fetch(endpoint);
            if (!response.ok) {
                throw new Error(`Error al obtener datos: ${response.status}`);
            }
            const data = await response.json();
            return data;
        } catch (error) {
            console.error(error);
            return [];
        }
    }

    // Función para establecer los datos en el gráfico
    async function setIntervalData(interval) {
        const data = await fetchData(interval);
        candlestickSeries.setData(data);
        // Ajustar el intervalo temporal del gráfico
        // adjustBarSpacing(interval);  
    }

    // Inicialización con el intervalo de 4 horas
    setIntervalData('4h');

    // Función para ajustar el espaciado de las barras basado en el intervalo
    function adjustBarSpacing(interval) {
        let barSpacing = 0;

        switch (interval) {
            case '15m':
                barSpacing = 2;  // 15 minutos, más espacio entre las velas
                break;
            case '4h':
                barSpacing = 6;  // 4 horas, un poco más de espacio
                break;
            case '1d':
                barSpacing = 12;  // 1 día, menos espacio entre las velas
                break;
            case '1w':
                barSpacing = 24;  // 1 semana, más espacio
                break;
            default:
                barSpacing = 6;  // Intervalo por defecto
                break;
        }

        // Ajustar la propiedad barSpacing del gráfico
        chart.applyOptions({
            timeScale: {
                barSpacing: barSpacing
            }
        });
    }

    // Ajustar tamaño del gráfico al redimensionar la ventana
    window.addEventListener('resize', () => {
        chart.applyOptions({
            width: document.getElementById('crypto-chart').clientWidth,
        });
    });
</script>